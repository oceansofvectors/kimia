apiVersion: batch/v1
kind: Job
metadata:
  name: buildkit-test
spec:
  template:
    spec:
      restartPolicy: Never
      securityContext:
        runAsUser: 1000
        fsGroup: 1000
      containers:
      - name: smithy
        image: 100.92.16.57:5000/rapidfort/smithy
        args:
          - "--context=https://github.com/nginxinc/docker-nginx.git"
          - "--git-branch=master"
          - "--dockerfile=mainline/alpine/Dockerfile"
          - "--destination=test:latest"
          - "--no-push"
        securityContext:
          allowPrivilegeEscalation: true
          capabilities:
            add: [SETUID, SETGID]
            drop: [ALL]
        volumeMounts:
        - name: work
          mountPath: /home/smithy
      volumes:
      - name: work
        emptyDir: {}

