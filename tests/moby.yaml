apiVersion: batch/v1
kind: Job
metadata:
  name: moby-fixed
spec:
  template:
    spec:
      restartPolicy: Never
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
      containers:
      - name: buildkit
        image: moby/buildkit:rootless
        command: ["sleep", "inf"]
        securityContext:
          # Critical for BuildKit rootless to work properly
          runAsUser: 1000
          runAsGroup: 1000
          allowPrivilegeEscalation: true
          seccompProfile:
            type: Unconfined  # IMPORTANT: BuildKit needs unconfined seccomp
          capabilities:
            add:
              - SETUID
              - SETGID
            drop:
              - ALL

